<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ“„ Paper Package & Cost Calculator</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #eef2f6;
        padding: 10px;
      }
      h2 {
        text-align: center;
        color: #0d47a1;
        font-size: 1.3em;
      }
      table th,
      table td {
        text-align: center;
      }
      tr:hover {
        background: #dbeeff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>ðŸ“„ Paper Package & Cost Calculator</h2>

      <div class="mb-3">
        <label class="form-label">Number of Books: </label>
        <input
          type="number"
          id="numBooks"
          class="form-control"
          oninput="createBookTable()"
        />
      </div>

      <div id="bookTableContainer" class="table-responsive"></div>

      <div id="resultTable" style="display: none" class="table-responsive">
        <h3>ðŸ“Š Calculation Result</h3>
        <table class="table table-bordered table-hover">
          <thead class="table-primary">
            <tr>
              <th>Book #</th>
              <th>Paper + Material</th>
              <th>Total Sheets</th>
              <th>Binding Type</th>
              <th>Price per Book ($)</th>
            </tr>
          </thead>
          <tbody id="resultBody"></tbody>
        </table>
      </div>
    </div>

    <!-- jQuery & Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Cost Constants
      const TonerCostPerSheet = 962 / 90000;
      const InsideBookCostA4 = 31 / 4000;
      const InsideBookCostA3 = 31 / 2000;
      const CoverCost = 18 / 400;
      const LaminateCost = 8 / 400;
      const BindingCost = 150 / 10000;
      const StapleCost = (17 / 20 / 1000) * 2;

      function formatNumber(num) {
        return num.toFixed(2);
      }

      function createBookTable() {
        const num = parseInt($("#numBooks").val());
        const container = $("#bookTableContainer");
        container.html("");
        if (isNaN(num) || num <= 0) return;

        let html = `<table class="table table-bordered table-hover">
      <thead class="table-primary"><tr>
        <th>Book #</th><th>Pages</th><th>Qty</th><th>Paper</th><th>Material</th><th>Binding</th>
      </tr></thead><tbody>`;

        for (let i = 1; i <= num; i++) {
          html += `<tr>
        <td>${i}</td>
        <td><input type="number" id="pages${i}" class="form-control" oninput="updateCalculation()"></td>
        <td><input type="number" id="qty${i}" class="form-control" oninput="updateCalculation()"></td>
        <td>
          <select id="paper${i}" class="form-select" onchange="updateCalculation()">
            <option value="A3">A3</option>
            <option value="A4">A4</option>
          </select>
        </td>
        <td>
          <select id="material${i}" class="form-select" onchange="updateCalculation()">
            <option value="WF">WF</option>
            <option value="MT">MT</option>
          </select>
        </td>
        <td>
          <select id="binding${i}" class="form-select" onchange="updateCalculation()">
            <option value="Perfect">Perfect Binding</option>
            <option value="Staple">Staple</option>
          </select>
        </td>
      </tr>`;
        }

        html += "</tbody></table>";
        container.html(html);
      }

      function updateCalculation() {
        const numBooks = parseInt($("#numBooks").val());
        const resultBody = $("#resultBody");
        const resultTable = $("#resultTable");
        if (isNaN(numBooks) || numBooks <= 0) return;

        resultBody.html("");
        let grandTotal = 0;

        for (let i = 1; i <= numBooks; i++) {
          const pages = parseInt($("#pages" + i).val() || 0);
          const qty = parseInt($("#qty" + i).val() || 0);
          const paper = $("#paper" + i).val();
          const material = $("#material" + i).val();
          const binding = $("#binding" + i).val();

          if (pages <= 0 || qty <= 0) continue;

          // Sheets inside book
          const sheets = Math.ceil(pages / 2);

          // Cover = 2 A3 = 4 A4 pages
          const coverSheetsA4 = 4;

          // Toner cost (inside + cover)
          const totalTonerSheetsA4 =
            paper === "A4"
              ? sheets + coverSheetsA4
              : sheets * 2 + coverSheetsA4;
          const tonerCost = totalTonerSheetsA4 * TonerCostPerSheet;

          // Inside book cost
          const insideCost =
            paper === "A4"
              ? sheets * InsideBookCostA4
              : sheets * InsideBookCostA3;

          // Cover + Laminate cost
          const coverLaminate = CoverCost + LaminateCost;

          // Binding/Staple cost
          const bindCost = binding === "Perfect" ? BindingCost : StapleCost;

          // Total cost per book
          const pricePerBook =
            tonerCost + insideCost + coverLaminate + bindCost;

          // Total cost * quantity
          const totalBookCost = pricePerBook * qty;
          grandTotal += totalBookCost;

          resultBody.append(`<tr>
        <td>${i}</td>
        <td>${paper} - ${material}</td>
        <td>${sheets}</td>
        <td>${binding}</td>
        <td>${formatNumber(pricePerBook)}</td>
      </tr>`);
        }

        // Grand total row
        resultBody.append(`<tr class="table-success fw-bold">
      <td colspan="4">Grand Total ($)</td>
      <td>${formatNumber(grandTotal)}</td>
    </tr>`);

        resultTable.show();
      }
    </script>
  </body>
</html>
