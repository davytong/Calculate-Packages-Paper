<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ðŸ“„ Paper Package & Cost Calculator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", Arial, sans-serif;
        background: linear-gradient(135deg, #e8f7ff, #fdfdfd);
        padding: 20px;
        margin-bottom: 200px;
      }
      .container {
        background: #fff;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      }
      .main-title {
        font-weight: 800;
        font-size: 2rem;
        text-align: center;
        color: #0d6efd;
        margin-bottom: 25px;
      }
      .book-card {
        border: none;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        background: #f0f8ff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        transition: 0.3s;
      }
      .book-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }
      .book-card.expensive {
        border: 2px solid #ffc107;
        background: #fff3cd;
      }
      .book-card label {
        font-weight: 600;
        color: #495057;
      }
      .capacity-card {
        background: #e3f2fd;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 15px;
      }
      .capacity-card i {
        font-size: 1.5rem;
        color: #0d6efd;
      }
      .capacity-card .capacity-label {
        font-weight: 600;
        margin-right: 10px;
      }
      .capacity-input {
        width: 120px;
        font-size: 0.9rem;
      }
      .capacity-slider {
        flex: 1;
        margin-right: 10px;
      }
      #summaryCards .card {
        transition: all 0.5s ease;
      }
      #summaryCards .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      #historyArea {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-height: 300px;
        background: #f8f9fa;
        border-top: 3px solid #0d6efd;
        padding: 15px 20px;
        overflow-y: auto;
        z-index: 999;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        transition: 0.3s;
      }
      .history-card:hover {
        background-color: #d1e7ff;
        cursor: pointer;
        transition: background 0.2s;
      }
      .history-card.selected {
        background-color: #0d6efd;
        color: #fff;
      }
      @media (max-width: 767px) {
        .book-card .col-12 {
          flex: 0 0 100%;
          max-width: 100%;
        }
        .book-card {
          padding: 12px;
        }
        .capacity-card {
          flex-direction: column;
          align-items: flex-start;
        }
        .capacity-slider {
          width: 100%;
          margin-right: 0;
        }
      }
      @media print {
        #bookTableContainer,
        #numBooks,
        #dailyCapacityMain,
        #dailyCapacitySlider,
        #btnCalculate,
        #toggleHistory,
        button {
          display: none !important;
        }
        body {
          margin: 0.5mm;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-title">
        <i class="fa-solid fa-book"></i> Paper Package & Cost Calculator
      </div>

  

      <div class="mb-3 d-flex justify-content-between align-items-center">
        <button id="toggleHistory" class="btn btn-info no-print">
          <i class="fa-solid fa-clock-rotate-left"></i> Show / Hide History
        </button>
      </div>

      <div class="mb-3">
        <label class="form-label fw-bold"
          ><i class="fa-solid fa-list-ol"></i> Number of Books:</label
        >
        <input
          id="numBooks"
          class="form-control"
          type="number"
          min="1"
          placeholder="Enter number of books"
          required
        />
      </div>

      <div id="bookTableContainer"></div>

      <button id="btnCalculate" class="btn btn-primary mb-3">
        <i class="fa-solid fa-equals"></i> Save / Calculate
      </button>

      <div id="resultArea" style="display: none">
        <h5 class="mt-3">
          <i class="fa-solid fa-chart-column"></i> Calculation Result
        </h5>

        <div class="table-responsive mb-3">
          <table class="table table-sm table-bordered text-center">
            <thead class="table-primary">
              <tr>
                <th>#</th>
                <th>Pages</th>
                <th>Qty</th>
                <th>Paper</th>
                <th>Material</th>
                <th>Bind</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody id="resultBody"></tbody>
          </table>
        </div>

        <h5 class="mt-3 text-warning">
          <i class="fa-solid fa-box-open"></i> Paper Packs Needed
        </h5>
        <div class="table-responsive mb-3">
          <table class="table table-sm table-bordered">
            <thead class="table-warning">
              <tr>
                <th>Paper Type</th>
                <th>Total Sheets</th>
                <th>Packs Needed</th>
              </tr>
            </thead>
            <tbody id="packBody"></tbody>
          </table>
        </div>

            <!-- ===== Capacity Card ===== -->
      <div class="capacity-card">
        <i class="fa-solid fa-tachometer-alt"></i>
        <span class="capacity-label">Daily Printing Capacity (sheets):</span>
        <input id="dailyCapacityMain" type="number" class="form-control capacity-input" min="1000" step="1000" value="50000">
        <input id="dailyCapacitySlider" type="range" class="form-range capacity-slider" min="1000" max="100000" step="1000" value="50000">
        <span>Total Days: <b id="totalDaysDisplay">0</b></span>
      </div>
      
        <div id="summaryBox" class="mt-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="fw-bold mb-0">
              <i class="fa-solid fa-star"></i> Summary
            </h5>
          </div>
          <div class="row g-3" id="summaryCards"></div>
        </div>
      </div>
    </div>

    <div id="historyArea" style="display: none">
      <h5>History (click to restore)</h5>
      <div id="historyCards"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      const TONER_COST_PER_SHEET = 962 / 90000,
        INSIDE_COST_A4 = 31 / 4000,
        INSIDE_COST_A3 = 31 / 2000,
        COVER_COST = 18 / 400,
        LAM_COST = 8 / 400,
        BINDING_COST = 150 / 10000,
        STAPLE_COST = (17 / 20 / 1000) * 2,
        PACK_WF_A4 = 500 * 8,
        PACK_MT_A4 = 250 * 8,
        PACK_A3 = 500 * 4,
        COVER_PACK = 400;

      let history = JSON.parse(localStorage.getItem("paperHistory")) || [];
      let lastJobHash = "";

      const fmtInt = (n) => Number(n).toLocaleString();
      const fmtPrice = (n) => "$" + Number(n).toFixed(2);

      function getDailyCapacity() {
        return parseInt($("#dailyCapacityMain").val()) || 50000;
      }

      function createBookTable(n) {
        if (!n || n < 1) {
          $("#bookTableContainer").html("");
          $("#resultArea").hide();
          return;
        }
        let html = "";
        for (let i = 1; i <= n; i++) {
          html += `
          <div class="book-card row g-2" id="bookCard${i}">
            <div class="col-12 col-md-1"><label>#${i}</label></div>
            <div class="col-12 col-md-2"><label>Pages</label><input type="number" id="pages${i}" class="form-control calc-input" min="1"></div>
            <div class="col-12 col-md-2"><label>Qty</label><input type="number" id="qty${i}" class="form-control calc-input" min="1"></div>
            <div class="col-12 col-md-2"><label>Paper</label><select id="paper${i}" class="form-select calc-input"><option value="A4">A4</option><option value="A3">A3</option></select></div>
            <div class="col-12 col-md-2"><label>Material</label><select id="material${i}" class="form-select calc-input"><option value="WF">WF</option><option value="MT">MT</option></select></div>
            <div class="col-12 col-md-3"><label>Binding</label><input type="text" id="binding${i}" class="form-control" readonly></div>
          </div>`;
        }
        $("#bookTableContainer").html(html);
      }

      function calculateBooks(saveHistory = false) {
        const n = parseInt($("#numBooks").val());
        if (!n || n < 1) {
          $("#resultArea").hide();
          return;
        }

        $("#resultBody,#packBody,#summaryCards").html("");

        let totalBooksQty = 0, totalCost = 0, totalCoverSheets = 0, totalA4Pages = 0;
        let sheetsWF = 0, sheetsMT = 0, sheetsA3 = 0;
        let bookRows = [];

        for (let i = 1; i <= n; i++) {
          const pages = parseInt($("#pages" + i).val()) || 0;
          const qty = parseInt($("#qty" + i).val()) || 0;
          const paper = $("#paper" + i).val();
          const material = $("#material" + i).val();
          const binding = paper === "A4" ? "Perfect" : "Staple";
          $("#binding" + i).val(binding);
          if (pages <= 0 || qty <= 0) continue;
          const sheetsPerBook = Math.ceil(pages / 2);
          const totalSheetsBook = sheetsPerBook * qty;
          const tonerSheets = paper === "A4" ? sheetsPerBook + 4 : sheetsPerBook * 2 + 4;
          const tonerCost = tonerSheets * TONER_COST_PER_SHEET;
          const insideCost = paper === "A4" ? sheetsPerBook * INSIDE_COST_A4 : sheetsPerBook * INSIDE_COST_A3;
          const pricePerBook = tonerCost + insideCost + COVER_COST + LAM_COST + (binding === "Perfect" ? BINDING_COST : STAPLE_COST);

          totalBooksQty += qty;
          totalCost += pricePerBook * qty;
          totalCoverSheets += qty;
          totalA4Pages += paper === "A4" ? totalSheetsBook : totalSheetsBook * 2;

          if (paper === "A4" && material === "WF") sheetsWF += totalSheetsBook;
          if (paper === "A4" && material === "MT") sheetsMT += totalSheetsBook;
          if (paper === "A3") sheetsA3 += totalSheetsBook;

          bookRows.push({ pages, qty, paper, material, binding, pricePerBook, cardId: `#bookCard${i}` });
        }

        bookRows.sort((a, b) => b.pricePerBook - a.pricePerBook);
        bookRows.forEach((b, i) => {
          $(b.cardId).toggleClass("expensive", b.pricePerBook > 50);
          $("#resultBody").append(`<tr>
            <td>${i + 1}</td><td>${b.pages}</td><td>${fmtInt(b.qty)}</td><td>${b.paper}</td><td>${b.material}</td><td>${b.binding}</td><td>${fmtPrice(b.pricePerBook)}</td>
          </tr>`);
        });

        const packsWF = sheetsWF > 0 ? Math.ceil(sheetsWF / PACK_WF_A4) : 0;
        const packsMT = sheetsMT > 0 ? Math.ceil(sheetsMT / PACK_MT_A4) : 0;
        const packsA3 = sheetsA3 > 0 ? Math.ceil(sheetsA3 / PACK_A3) : 0;
        const coverPacks = totalCoverSheets > 0 ? Math.ceil(totalCoverSheets / COVER_PACK) : 0;

        const dailyCapacity = getDailyCapacity();
        const totalDays = Math.ceil(totalA4Pages / dailyCapacity);
        $("#totalDaysDisplay").text(totalDays);

        if (sheetsWF > 0) $("#packBody").append(`<tr><td>A4-WF</td><td>${fmtInt(sheetsWF)}</td><td>${fmtInt(packsWF)}</td></tr>`);
        if (sheetsMT > 0) $("#packBody").append(`<tr><td>A4-MT</td><td>${fmtInt(sheetsMT)}</td><td>${fmtInt(packsMT)}</td></tr>`);
        if (sheetsA3 > 0) $("#packBody").append(`<tr><td>A3-WF</td><td>${fmtInt(sheetsA3)}</td><td>${fmtInt(packsA3)}</td></tr>`);
        if (totalCoverSheets > 0) $("#packBody").append(`<tr><td>Cover GL</td><td>${fmtInt(totalCoverSheets)}</td><td>${fmtInt(coverPacks)}</td></tr>`);

        const cards = [
          { title: "Total Books", icon: "fa-solid fa-book", value: fmtInt(totalBooksQty), color: "primary" },
          { title: "Total Days", icon: "fa-solid fa-clock", value: fmtInt(totalDays), color: "info" },
          { title: "Total Cost", icon: "fa-solid fa-dollar-sign", value: fmtPrice(totalCost), color: "danger" },
          { title: "Cover Packs", icon: "fa-solid fa-box", value: fmtInt(coverPacks), color: "warning" }
        ];
        if (packsWF > 0) cards.push({ title: "A4 WF Packs", icon: "fa-solid fa-cubes", value: fmtInt(packsWF), color: "success" });
        if (packsMT > 0) cards.push({ title: "A4 MT Packs", icon: "fa-solid fa-cubes-stacked", value: fmtInt(packsMT), color: "secondary" });
        if (packsA3 > 0) cards.push({ title: "A3 WF Packs", icon: "fa-solid fa-boxes-stacked", value: fmtInt(packsA3), color: "dark" });

        $("#summaryCards").html("");
        cards.forEach((c) => {
          const col = $(`<div class="col-12 col-sm-6 col-md-3 mb-3"></div>`);
          const card = $(`<div class="card text-white bg-${c.color} h-100 shadow-sm">
            <div class="card-body text-center">
              <i class="${c.icon} fa-2x mb-2"></i>
              <h6 class="card-title fw-bold">${c.title}</h6>
              <p class="card-text fs-5 fw-bold">${c.value}</p>
            </div>
          </div>`);
          col.append(card);
          $("#summaryCards").append(col);
        });

        $("#resultArea").show();
        if (saveHistory) saveWorkHistory(n, totalBooksQty, totalCost, totalDays, sheetsWF, sheetsMT, sheetsA3, totalCoverSheets, packsWF, packsMT, packsA3, coverPacks, bookRows);
      }

      function saveWorkHistory(n, totalBooksQty, totalCost, totalDays, sheetsWF, sheetsMT, sheetsA3, totalCoverSheets, packsWF, packsMT, packsA3, coverPacks, bookRows) {
        const hash = btoa(bookRows.map(b => `${b.pages}-${b.qty}-${b.paper}-${b.material}`).join("|"));
        if (hash === lastJobHash) return;
        lastJobHash = hash;
        const entry = { timestamp: new Date().toLocaleString(), books: n, totalBooksQty, totalCost, totalDays, sheetsWF, sheetsMT, sheetsA3, totalCoverSheets, packsWF, packsMT, packsA3, coverPacks, bookRows };
        history.unshift(entry);
        if (history.length > 50) history.pop();
        localStorage.setItem("paperHistory", JSON.stringify(history));
        updateHistoryUI();
      }

      function updateHistoryUI() {
        const html = history.map((h, i) => `<div class="history-card p-2 mb-1" data-index="${i}">
          <b>${h.timestamp}</b> | Books: ${h.books} | Cost: ${fmtPrice(h.totalCost)} | Days: ${h.totalDays}
        </div>`).join("");
        $("#historyCards").html(html);
      }

      $("#numBooks").on("input", function () {
        createBookTable(parseInt($(this).val()));
        calculateBooks(false);
      });

      $("#btnCalculate").on("click", function () {
        calculateBooks(true);
      });

      $("#toggleHistory").on("click", function () {
        $("#historyArea").toggle();
      });

      $("#historyCards").on("click", ".history-card", function () {
        const index = $(this).data("index");
        const h = history[index];
        $("#numBooks").val(h.books);
        createBookTable(h.books);
        h.bookRows.forEach((b, i) => {
          $(`#pages${i + 1}`).val(b.pages);
          $(`#qty${i + 1}`).val(b.qty);
          $(`#paper${i + 1}`).val(b.paper);
          $(`#material${i + 1}`).val(b.material);
        });
        calculateBooks(false);
      });

      $(document).on("input change", ".calc-input, #dailyCapacityMain, #dailyCapacitySlider", function () {
        if (this.id === "dailyCapacityMain") $("#dailyCapacitySlider").val($(this).val());
        if (this.id === "dailyCapacitySlider") $("#dailyCapacityMain").val($(this).val());
        calculateBooks(false);
      });

      updateHistoryUI();
    </script>
  </body>
</html>
